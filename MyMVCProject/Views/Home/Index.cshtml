@* @{
    ViewData["Title"] = "DressUp Gallery";
}

<div class="container my-5">
    <h2 class="text-center mb-4">Let's Play DressUp</h2>
    <div id="gallery" class="row"></div>

    <div id="loader" class="text-center my-4">
        <div class="spinner-border text-secondary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/js/Index.js"></script>
}
 *@
<link rel="stylesheet" href="~/css/Index.css" asp-append-version="true" />
<base href="~/Images/~" />

<div class="container my-5">
    <h2 class="text-center mb-4 fancy-heading">Discover Your Style ✨</h2>

    <section id="gallery" class="gallery-grid"></section>

    <div id="loading" class="text-center mt-4">
        <div class="spinner-border text-dark" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        const gallery = document.getElementById('gallery');
        const loading = document.getElementById('loading');

        const images = [
            { src: 'Lela Rose Pre-Fall 2015 Fashion Show.jpeg', title: 'Floral Dress', price: '₹1,499', rating: '⭐ 4.5', gender: 'women', type: 'dress' },
            { src: 'A volta do decote ombro a ombro_ 15 looks com a trend.jpeg', title: 'Denim Jeans', price: '₹2,199', rating: '⭐ 4.7', gender: 'women', type: 'Jeans' },
            { src: 'download (1).jpeg', title: 'Formal Dress', price: '₹2,499', rating: '⭐ 4.8', gender: 'women', type: 'Dress' },
            { src: 'download (2).jpeg', title: 'Floral Dress', price: '₹1,799', rating: '⭐ 4.4', gender: 'women', type: 'Dress' },
            { src: 'download.jpeg', title: 'Aline Dress', price: '₹1,299', rating: '⭐ 4.6', gender: 'women', type: 'Dress' },
            { src: 'Jaeda Shirt _ Chocolate.jpeg', title: 'Brown Shirt', price: '₹999', rating: '⭐ 4.3', gender: 'women', type: 'Shirt' },
            { src: 'The 7-Piece Jeanne Damas French Capsule Wardrobe.jpeg', title: 'Blue Jeans', price: '₹799', rating: '⭐ 4.2', gender: 'women', type: 'Jeans' },
            { src: 'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=800&q=80', title: 'Casual Tee', price: '₹799', rating: '⭐ 4.2', gender: 'women', type: 'Shirt' },
        ];

        let index = 0;
        const chunkSize = 20;
        let searchTerm = localStorage.getItem('dressup-search') || '';

        function filterImages() {
            if (!searchTerm) return images;
            const terms = searchTerm.split(' ');
            return images.filter(item =>
                terms.every(t =>
                    item.title.toLowerCase().includes(t) ||
                    item.gender.toLowerCase().includes(t) ||
                    item.type.toLowerCase().includes(t)
                )
            );
        }

        const filtered = filterImages();

        function loadMore() {
            const slice = filtered.slice(index, index + chunkSize);
            slice.forEach(item => {
                const fig = document.createElement('figure');
                fig.classList.add('item');
                fig.innerHTML = `
                    <img src="${item.src}" alt="${item.title}">
                    <figcaption>
                        <h5>${item.title}</h5>
                        <p>${item.price}</p>
                        <span>${item.rating}</span>

                        <div class="hover-options">
                            <div class="sizes">
                                <button class="size">S</button>
                                <button class="size">M</button>
                                <button class="size">L</button>
                            </div>
                            <div class="actions">
                                <button class="wishlist-btn"><i class="bi bi-heart"></i></button>
                                <button class="add-cart">Add to Cart</button>
                            </div>
                        </div>
                    </figcaption>`;
                gallery.appendChild(fig);
            });
            index += chunkSize;
            loading.style.display = "none";
        }

        loadMore();

        // Infinite scroll
        const observer = new IntersectionObserver(entries => {
            if (entries[0].isIntersecting && index < filtered.length) {
                loading.style.display = "block";
                setTimeout(() => loadMore(), 800);
            }
        });
        observer.observe(loading);

        // ========================
        // ❤️ Wishlist + 🛒 Cart Logic
        // ========================
        gallery.addEventListener('click', (e) => {
            const item = e.target.closest('figure');
            if (!item) return;

            // ❤️ Wishlist
            const heart = e.target.closest('.wishlist-btn');
            if (heart) {
                heart.classList.toggle('active');

                const img = item.querySelector('img').src;
                const title = item.querySelector('h5').innerText;
                const price = item.querySelector('p').innerText;

                let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
                const exists = wishlist.find(x => x.src === img);

                if (exists) {
                    wishlist = wishlist.filter(x => x.src !== img);
                    heart.querySelector('i').classList.replace('bi-heart-fill', 'bi-heart');
                } else {
                    wishlist.unshift({ src: img, title, price });
                    heart.querySelector('i').classList.replace('bi-heart', 'bi-heart-fill');
                }

                localStorage.setItem('wishlist', JSON.stringify(wishlist));

                const badge = document.getElementById('wishlist-count');
                if (badge) {
                    badge.style.display = wishlist.length > 0 ? 'inline-block' : 'none';
                    badge.textContent = wishlist.length;
                }
            }

            // 🛒 Add to Cart
            const addCart = e.target.closest('.add-cart');
            if (addCart) {
                const selectedSize = item.querySelector('.size.selected');
                if (!selectedSize) {
                    alert("Please select a size before adding to cart.");
                    return;
                }

                const img = item.querySelector('img').src;
                const title = item.querySelector('h5').innerText;
                const price = item.querySelector('p').innerText;
                const size = selectedSize.innerText;

                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                const exists = cart.find(x => x.src === img && x.size === size);

                if (!exists) {
                    cart.unshift({ src: img, title, price, size });
                    localStorage.setItem('cart', JSON.stringify(cart));
                }

                const cartBadge = document.getElementById('cart-count');
                if (cartBadge) {
                    cartBadge.style.display = cart.length > 0 ? 'inline-block' : 'none';
                    cartBadge.textContent = cart.length;
                }

                addCart.innerText = "Added!";
                addCart.disabled = true;
                setTimeout(() => {
                    addCart.innerText = "Add to Cart";
                    addCart.disabled = false;
                }, 1000);
            }

            // 🔘 Size selection
            const sizeBtn = e.target.closest('.size');
            if (sizeBtn) {
                const allSizes = sizeBtn.parentElement.querySelectorAll('.size');
                allSizes.forEach(btn => btn.classList.remove('selected'));
                sizeBtn.classList.add('selected');
            }
        });

        // Initialize badge counts on page load
        window.addEventListener('load', () => {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            const wishlistBadge = document.getElementById('wishlist-count');
            const cartBadge = document.getElementById('cart-count');

            if (wishlistBadge) {
                wishlistBadge.style.display = wishlist.length > 0 ? 'inline-block' : 'none';
                wishlistBadge.textContent = wishlist.length;
            }
            if (cartBadge) {
                cartBadge.style.display = cart.length > 0 ? 'inline-block' : 'none';
                cartBadge.textContent = cart.length;
            }
        });

        localStorage.removeItem('dressup-search');
    </script>
}


